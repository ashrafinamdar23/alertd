@model IEnumerable<AlertPortal.Web.ViewModels.CustomerVm>
@using Coe.UI.Models
@{
    ViewData["Title"] = "Customers";

    var table = new DataTableModel
    {
        Columns =
        {
            new DataTableColumn { Header = "Id",   Key = "id",   WidthStyle = "80px" },
            new DataTableColumn { Header = "Name", Key = "name" }
        }
    };

    foreach (var c in Model)
    {
        table.Rows.Add(new DataTableRow
        {
            Cells = new Dictionary<string, string>
            {
                ["id"] = c.Id.ToString(),
                ["name"] = HtmlEncoder.Encode(c.Name) // or just c.Name if trusted
            },
            Actions = new List<DataTableAction>
            {
                new DataTableAction
                {
                    Type = DataTableActionType.Link,
                    Text = "Edit",
                    Class = "btn btn-outline-secondary btn-sm",
                    Href = Url.Action("Edit","Customers", new { id = c.Id })
                },
                new DataTableAction
                {
                    Type  = DataTableActionType.Link,
                    Text  = "Delete",
                    Class = "btn btn-outline-danger btn-sm",
                    Href  = Url.Action("Delete","Customers", new { id = c.Id }),
                    Method = "POST",
                    DataAttributes = new Dictionary<string,string>
                    {
                        ["data-coe-delete"] = "true",
                        ["data-name"] = c.Name,
                        ["data-coe-confirm-title"] = "Delete customer",
                        ["data-coe-confirm-body"]  = "This cannot be undone.",
                        ["data-coe-confirm-class"] = "btn-danger"
                    }
                }
            }
        });
    }
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">Customers</h1>
    <a class="btn btn-primary" asp-controller="Customers" asp-action="Create">New Customer</a>
</div>

@Html.AntiForgeryToken()

@await Component.InvokeAsync("DataTable", table)

@section Scripts {
    @* Toasts from TempData *@
    @if (TempData["Toast.Success"] is string ok)
    {
        <script>showToast({ title: 'Success', body: @Json.Serialize(ok), variant: 'success' });</script>
    }
    @if (TempData["Toast.Warning"] is string warn)
    {
        <script>showToast({ title: 'Notice', body: @Json.Serialize(warn), variant: 'warning' });</script>
    }
}
